def negate_literal(literal):
    return literal[1:] if literal.startswith('~') else '~' + literal

def resolve(ci, cj):
    resolvents = []
    for di in ci:
        for dj in cj:
            if di == negate_literal(dj):
                new_clause = list(set(ci + cj))
                new_clause.remove(di)
                new_clause.remove(dj)
                resolvents.append(sorted(set(new_clause)))
    return resolvents

def resolution(kb, query):
    kb = [sorted(set(clause)) for clause in kb]
    query_negated = [negate_literal(lit) for lit in query]
    kb.append(query_negated)
    print(f"Initial KB (with negated query): {kb}\n")
    new = set()
    while True:
        pairs = [(kb[i], kb[j]) for i in range(len(kb)) for j in range(i + 1, len(kb))]
        generated_any = False
        for (ci, cj) in pairs:
            resolvents = resolve(ci, cj)
            for resolvent in resolvents:
                if not resolvent:
                    print(f"Resolved {ci} and {cj} to get []")
                    return True
                resolvent_tuple = tuple(sorted(resolvent))
                if resolvent_tuple not in new:
                    print(f"Resolved {ci} and {cj} â†’ {resolvent}")
                    new.add(resolvent_tuple)
                    generated_any = True
        if not generated_any:
            print("No more resolvents. Query NOT entailed.")
            return False
        for clause in new:
            if list(clause) not in kb:
                kb.append(list(clause))

kb = [['P', 'Q'], ['~P', 'R'], ['~Q', 'R']]
query = ['R']
result = resolution(kb, query)
print("\nFinal Result:", result)
